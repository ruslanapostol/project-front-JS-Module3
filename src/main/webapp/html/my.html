<!DOCTYPE html>
<html lang="en">
<head>
    <title>RPG</title>
    <script src=https://code.jquery.com/jquery-3.6.0.min.js></script>
    <link href="/css/my.css" rel="stylesheet">
</head>
<body>
<h1>RPG admin panel</h1>
<table id="rpgTable">
    <thead>
    <tr>
        <th>#</th>
        <th>Name</th>
        <th>Title</th>
        <th>Race</th>
        <th>Profession</th>
        <th>Level</th>
        <th>Birthday</th>
        <th>Banned</th>
    </tr>
    </thead>
    <tbody>
    <!-- Data rows will go here -->
    </tbody>
</table>

<div id="accountDisplayOptions">
    <label for="accountCountDropdown">Accounts to display:</label>
    <select id="accountCountDropdown">
        <option value="3">3</option>
        <option value="5">5</option>
        <option value="10">10</option>
        <option value="15">15</option>
        <option value="20">20</option>
    </select>
</div>

<!-- Paging buttons section -->
<div id="pagingButtons">
    <button>Prev</button>
    <button>1</button>
    <button>2</button>
    <button>3</button>
    <button>4</button>
    <button>5</button>
    <button>Next</button>
</div>
<script>
    let currentPage = 1;
    let accountsPerPage = parseInt(document.getElementById('accountCountDropdown').value, 10);
    function fetchPlayers(pageNumber, pageSize) {
        const url = `/rest/players?pageNumber=${pageNumber}&pageSize=${pageSize}`;
        fetch(url)
            .then(response => response.json())
            .then(players => {
                const table = document.getElementById('rpgTable').getElementsByTagName('tbody')[0];
                table.innerHTML = "";
                players.forEach((player, index) => {
                    const row = table.insertRow();
                    const cell1 = row.insertCell(0);
                    const cell2 = row.insertCell(1);
                    const cell3 = row.insertCell(2);
                    const cell4 = row.insertCell(3);
                    const cell5 = row.insertCell(4);
                    const cell6 = row.insertCell(5);
                    const cell7 = row.insertCell(6);
                    const cell8 = row.insertCell(7);
                    cell1.innerHTML = ((pageNumber -1) * pageSize) + index + 1;
                    cell2.innerHTML = player.name;
                    cell3.innerHTML = player.title;
                    cell4.innerHTML = player.race;
                    cell5.innerHTML = player.profession;
                    cell6.innerHTML = player.level;
                    cell7.innerHTML = new Date(player.birthday).toLocaleDateString();
                    cell8.innerHTML = player.banned ? 'Yes' : 'No';
                });
            })
            .catch(error => console.error('Error fetching players:', error));
    }

    // Function to fetch the total number of players/accounts and update page count
    function fetchTotalAccountsAndUpdatePages() {
        fetch('/rest/players/count')
            .then(response => response.json())
            .then(totalCount => {
                totalAccounts = totalCount;
                updateTotalPages();
            })
            .catch(error => console.error('Error fetching total accounts:', error));
    }

    function updateTotalPages() {
        const totalPages = Math.ceil(totalAccounts / accountsPerPage);
        const pagingButtons = document.getElementById('pagingButtons');
        // Clear existing buttons before adding new ones
        pagingButtons.innerHTML = '';

        const prevButton = document.createElement('button');
        prevButton.innerText = 'Prev';
        prevButton.disabled = currentPage === 1;
        prevButton.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                fetchPlayers(currentPage, accountsPerPage);
            }
        });
        pagingButtons.appendChild(prevButton);

        // Add page number buttons
        for (let page = 1; page <= totalPages; page++) {
            const button = document.createElement('button');
            button.innerText = page;
            button.addEventListener('click', function() {
                currentPage = page;
                fetchPlayers(currentPage, accountsPerPage);
            });

            // Highlight the current page button
            if (page === currentPage) {
                button.className = 'active'; // Add 'active' class to highlight the current page
            }

            pagingButtons.appendChild(button);
        }

        const nextButton = document.createElement('button');
        nextButton.innerText = 'Next';
        nextButton.disabled = currentPage === totalPages;
        nextButton.addEventListener('click', () => {
            if (currentPage < totalPages) {
                currentPage++;
                fetchPlayers(currentPage, accountsPerPage);
            }
        });
        pagingButtons.appendChild(nextButton); // Add 'Next' at the end

        console.log('Total pages:', totalPages);
    }



    document.getElementById('accountCountDropdown').addEventListener('change', function() {
        accountsPerPage = parseInt(this.value, 10);
        fetchTotalAccountsAndUpdatePages(); // Recalculate total pages and update view
        fetchPlayers(currentPage, accountsPerPage); // Fetch players for the current page with new page size
    });

    // Initial calls
    window.onload = function() {
        fetchPlayers(currentPage, accountsPerPage);
        fetchTotalAccountsAndUpdatePages(); // Get initial total accounts and calculate pages
    };
</script>

</body>
</html>